<!doctype html><html lang=en-us dir=ltr><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="
  IAM
  #

IAM = Identity Access Management
Manages: Identity (who?) has role (what access) for which resource (or organization, project, folder).
Use the principle of least access.
Permissions not granted directly to the user.
Permissions are grouped into roles which are granted to the authenticated members.
IAM policy defines and enforces what roles are granted to which members.
This policy is attached to a resource.

  Policy architecture
  #

Policy:
  Metadata:
    etags: concurrency control
    version: specifies schema version
  Audit-Config: configures audit logging
  Binding:
    Condition: constrains binding
    Member: []
    Role:
      Permissions: []
Member is an identity that can access a resource.
Identity is an e-mail account associated with a user, service account or a Google group, a domain name associated with a GSuite or cloud identity domains."><meta name=theme-color content="#FFFFFF"><meta name=color-scheme content="light dark"><meta property="og:url" content="https://dpurge.github.io/docs/devops/gcp/iam/"><meta property="og:site_name" content="Notebook"><meta property="og:title" content="Notebook"><meta property="og:description" content="IAM # IAM = Identity Access Management
Manages: Identity (who?) has role (what access) for which resource (or organization, project, folder).
Use the principle of least access.
Permissions not granted directly to the user. Permissions are grouped into roles which are granted to the authenticated members.
IAM policy defines and enforces what roles are granted to which members. This policy is attached to a resource.
Policy architecture # Policy: Metadata: etags: concurrency control version: specifies schema version Audit-Config: configures audit logging Binding: Condition: constrains binding Member: [] Role: Permissions: [] Member is an identity that can access a resource. Identity is an e-mail account associated with a user, service account or a Google group, a domain name associated with a GSuite or cloud identity domains."><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="docs"><meta property="article:modified_time" content="2024-11-05T15:49:10+01:00"><title>Iam | Notebook</title>
<link rel=manifest href=/manifest.json><link rel=icon href=/favicon.png type=image/x-icon><link rel=stylesheet href=/book.min.82c5dbd23447cee0b4c2aa3ed08ce0961faa40e1fa370eee4f8c9f02e0d46b5f.css integrity="sha256-gsXb0jRHzuC0wqo+0Izglh+qQOH6Nw7uT4yfAuDUa18=" crossorigin=anonymous><script defer src=/flexsearch.min.js></script><script defer src=/en.search.min.835d5a62048b9d8275765e13f670a18cf22efa62c53a85c2c06acafb4e6cb7b6.js integrity="sha256-g11aYgSLnYJ1dl4T9nChjPIu+mLFOoXCwGrK+05st7Y=" crossorigin=anonymous></script><script defer src=/sw.min.6f6f90fcb8eb1c49ec389838e6b801d0de19430b8e516902f8d75c3c8bd98739.js integrity="sha256-b2+Q/LjrHEnsOJg45rgB0N4ZQwuOUWkC+NdcPIvZhzk=" crossorigin=anonymous></script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/><span>Notebook</span></a></h2><div class=book-search><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><ul><li><input type=checkbox id=section-5ed42fa188b10ac098d312d036e5db61 class=toggle checked>
<label for=section-5ed42fa188b10ac098d312d036e5db61 class="flex justify-between"><a role=button>Devops</a></label><ul><li><input type=checkbox id=section-1fcf73664521c60a632dd1a03efd1f51 class=toggle>
<label for=section-1fcf73664521c60a632dd1a03efd1f51 class="flex justify-between"><a role=button>Ansible</a></label><ul><li><a href=/docs/devops/ansible/installation/>Installation</a></li></ul></li><li><input type=checkbox id=section-c2087d1a0cdf1643f70cd556cb17ad55 class=toggle>
<label for=section-c2087d1a0cdf1643f70cd556cb17ad55 class="flex justify-between"><a role=button>ArgoCD</a></label><ul><li><a href=/docs/devops/argo/installation/>Installation</a></li></ul></li><li><input type=checkbox id=section-f47ce4ece0f3dbd0b0d5520f3ec152ac class=toggle>
<label for=section-f47ce4ece0f3dbd0b0d5520f3ec152ac class="flex justify-between"><a href=/docs/devops/aws/>AWS</a></label><ul><li><a href=/docs/devops/aws/architecture/>Architecture</a></li><li><a href=/docs/devops/aws/aws-cli/>Aws CLI</a></li></ul></li><li><input type=checkbox id=section-6be09103bf6e030c155008595e01da99 class=toggle>
<label for=section-6be09103bf6e030c155008595e01da99 class="flex justify-between"><a role=button>Azure</a></label><ul><li><a href=/docs/devops/azure/exploring/>Exploring</a></li><li><a href=/docs/devops/azure/snippets/>Snippets</a></li></ul></li><li><input type=checkbox id=section-3582c732c4f454b4276fc327f0f84b75 class=toggle>
<label for=section-3582c732c4f454b4276fc327f0f84b75 class="flex justify-between"><a role=button>Blueprints</a></label><ul><li><a href=/docs/devops/blueprints/aws-3tier-webapp/>Aws 3tier Webapp</a></li><li><a href=/docs/devops/blueprints/aws-static-webapp/>Aws Static Webapp</a></li><li><a href=/docs/devops/blueprints/llm-closed-source/>Llm Closed Source</a></li></ul></li><li><input type=checkbox id=section-d17d00db7ed57a932813a4cfe8bef2c9 class=toggle>
<label for=section-d17d00db7ed57a932813a4cfe8bef2c9 class="flex justify-between"><a role=button>Docker</a></label><ul><li><a href=/docs/devops/docker/azure/>Azure</a></li><li><a href=/docs/devops/docker/basics/>Basics</a></li><li><a href=/docs/devops/docker/compose/>Compose</a></li><li><a href=/docs/devops/docker/installation/>Installation</a></li><li><a href=/docs/devops/docker/volumes/>Volumes</a></li></ul></li><li><input type=checkbox id=section-3a5deda6c7b3589dca066456e5c769e5 class=toggle checked>
<label for=section-3a5deda6c7b3589dca066456e5c769e5 class="flex justify-between"><a role=button>GCP</a></label><ul><li><a href=/docs/devops/gcp/cloud-shell/>Cloud Shell</a></li><li><a href=/docs/devops/gcp/definitions/>Definitions</a></li><li><a href=/docs/devops/gcp/firewall/>Firewall</a></li><li><a href=/docs/devops/gcp/functions/>Functions</a></li><li><a href=/docs/devops/gcp/gcloud/>Gcloud</a></li><li><a href=/docs/devops/gcp/gke-workload-identity/>Gke Workload Identity</a></li><li><a href=/docs/devops/gcp/gke/>Gke</a></li><li><a href=/docs/devops/gcp/iam/ class=active>Iam</a></li><li><a href=/docs/devops/gcp/networking/>Networking</a></li><li><a href=/docs/devops/gcp/vpc/>Vpc</a></li></ul></li><li><input type=checkbox id=section-9974b9802269f61682fb29dcad8dd329 class=toggle>
<label for=section-9974b9802269f61682fb29dcad8dd329 class="flex justify-between"><a role=button>Git</a></label><ul><li><a href=/docs/devops/git/branches/>Branches</a></li><li><a href=/docs/devops/git/configuration/>Configuration</a></li></ul></li><li><input type=checkbox id=section-64c3362c9e54d04fb3d47417b1fd82a3 class=toggle>
<label for=section-64c3362c9e54d04fb3d47417b1fd82a3 class="flex justify-between"><a role=button>Helm</a></label><ul><li><a href=/docs/devops/helm/charts/>Charts</a></li><li><a href=/docs/devops/helm/installation/>Installation</a></li></ul></li><li><input type=checkbox id=section-b998ae67e90826b64ad2b5c3cda70e97 class=toggle>
<label for=section-b998ae67e90826b64ad2b5c3cda70e97 class="flex justify-between"><a role=button>K3s</a></label><ul><li><a href=/docs/devops/k3s/k3d/>K3d</a></li><li><a href=/docs/devops/k3s/k3s/>K3s</a></li></ul></li><li><input type=checkbox id=section-6f0fb928174eee68ae46a2b065a10d98 class=toggle>
<label for=section-6f0fb928174eee68ae46a2b065a10d98 class="flex justify-between"><a href=/docs/devops/kubernetes/>Kubernetes</a></label><ul><li><a href=/docs/devops/kubernetes/azure-kubernetes/>Azure Kubernetes</a></li><li><a href=/docs/devops/kubernetes/deployment/>Deployment</a></li><li><a href=/docs/devops/kubernetes/design-patterns/>Design Patterns</a></li><li><a href=/docs/devops/kubernetes/ingress/>Ingress</a></li><li><a href=/docs/devops/kubernetes/k9s/>K9s</a></li><li><a href=/docs/devops/kubernetes/kubectl-config/>Kubectl Config</a></li><li><a href=/docs/devops/kubernetes/minikube/>Minikube</a></li><li><a href=/docs/devops/kubernetes/pod/>Pod</a></li><li><a href=/docs/devops/kubernetes/replica-set/>Replica Set</a></li><li><a href=/docs/devops/kubernetes/sealed-secrets/>Sealed Secrets</a></li><li><a href=/docs/devops/kubernetes/service/>Service</a></li><li><a href=/docs/devops/kubernetes/short-names/>Short Names</a></li></ul></li><li><input type=checkbox id=section-47a6b9cf18ba8fd999da8a767a80d55c class=toggle>
<label for=section-47a6b9cf18ba8fd999da8a767a80d55c class="flex justify-between"><a role=button>Linux</a></label><ul><li><a href=/docs/devops/linux/blocky/>Blocky</a></li><li><a href=/docs/devops/linux/caddy/>Caddy</a></li><li><a href=/docs/devops/linux/podman/>Podman</a></li><li><a href=/docs/devops/linux/screen/>Screen</a></li><li><a href=/docs/devops/linux/searxng/>Searxng</a></li><li><a href=/docs/devops/linux/setup/>Setup</a></li><li><a href=/docs/devops/linux/ubuntu/>Ubuntu</a></li></ul></li><li><input type=checkbox id=section-8c295e57838921fd2d675ad856381c28 class=toggle>
<label for=section-8c295e57838921fd2d675ad856381c28 class="flex justify-between"><a href=/docs/devops/macos/>MacOS</a></label><ul><li><a href=/docs/devops/macos/homebrew/>Homebrew</a></li><li><a href=/docs/devops/macos/java/>Java</a></li><li><a href=/docs/devops/macos/multipass/>Multipass</a></li><li><a href=/docs/devops/macos/python/>Python</a></li></ul></li><li><input type=checkbox id=section-10f7911111825950c64c7c1eaf3c1e76 class=toggle>
<label for=section-10f7911111825950c64c7c1eaf3c1e76 class="flex justify-between"><a href=/docs/devops/ollama/>Ollama</a></label><ul></ul></li><li><input type=checkbox id=section-d425dec9d097e6d0fb451b2000e12c4b class=toggle>
<label for=section-d425dec9d097e6d0fb451b2000e12c4b class="flex justify-between"><a role=button>Packer</a></label><ul><li><a href=/docs/devops/packer/installation/>Installation</a></li></ul></li><li><input type=checkbox id=section-fe27198961b1e6e0429110142052b0d0 class=toggle>
<label for=section-fe27198961b1e6e0429110142052b0d0 class="flex justify-between"><a href=/docs/devops/qemu/>QEmu</a></label><ul></ul></li><li><input type=checkbox id=section-fc00d5feb946b8fb7e89a44043aaff38 class=toggle>
<label for=section-fc00d5feb946b8fb7e89a44043aaff38 class="flex justify-between"><a href=/docs/devops/terraform/>Terraform</a></label><ul><li><a href=/docs/devops/terraform/aws/>Aws</a></li><li><a href=/docs/devops/terraform/basics/>Basics</a></li><li><a href=/docs/devops/terraform/installation/>Installation</a></li></ul></li><li><input type=checkbox id=section-510829274d6159e3c9c28d13c09cfce3 class=toggle>
<label for=section-510829274d6159e3c9c28d13c09cfce3 class="flex justify-between"><a role=button>Terragrunt</a></label><ul><li><a href=/docs/devops/terragrunt/basics/>Basics</a></li></ul></li><li><input type=checkbox id=section-17240d63f82733a8ccdf6e48de5bc2d7 class=toggle>
<label for=section-17240d63f82733a8ccdf6e48de5bc2d7 class="flex justify-between"><a role=button>Vagrant</a></label><ul><li><a href=/docs/devops/vagrant/installation/>Installation</a></li></ul></li><li><input type=checkbox id=section-952ea06750cba9d3a9b5281dd2b01470 class=toggle>
<label for=section-952ea06750cba9d3a9b5281dd2b01470 class="flex justify-between"><a role=button>Windows</a></label><ul><li><a href=/docs/devops/windows/ime/>Ime</a></li><li><a href=/docs/devops/windows/winget/>Winget</a></li></ul></li><li><input type=checkbox id=section-8ee96527a880b8936288c158356afd2f class=toggle>
<label for=section-8ee96527a880b8936288c158356afd2f class="flex justify-between"><a role=button>WSL</a></label><ul><li><a href=/docs/devops/wsl/installation/>Installation</a></li><li><a href=/docs/devops/wsl/ubuntu2004/>Ubuntu2004</a></li><li><a href=/docs/devops/wsl/ubuntu2204/>Ubuntu2204</a></li></ul></li></ul></li><li><input type=checkbox id=section-a934983054f48baad52d2e7a3a399e50 class=toggle>
<label for=section-a934983054f48baad52d2e7a3a399e50 class="flex justify-between"><a role=button>Other</a></label><ul><li><input type=checkbox id=section-ec6a0b8566b72facd57e317d36f672ac class=toggle>
<label for=section-ec6a0b8566b72facd57e317d36f672ac class="flex justify-between"><a role=button>Books</a></label><ul><li><a href=/docs/other/books/snippets/>Snippets</a></li></ul></li></ul></li><li><input type=checkbox id=section-ac57b6c9cca771981a03b1ba45863f8d class=toggle>
<label for=section-ac57b6c9cca771981a03b1ba45863f8d class="flex justify-between"><a role=button>Tools</a></label><ul><li><input type=checkbox id=section-a45750650ff56d259f4062f438098a5a class=toggle>
<label for=section-a45750650ff56d259f4062f438098a5a class="flex justify-between"><a role=button>AzCLI</a></label><ul></ul></li><li><input type=checkbox id=section-4087f1b5bc81bf1d3302521293bf244b class=toggle>
<label for=section-4087f1b5bc81bf1d3302521293bf244b class="flex justify-between"><a role=button>GraphViz</a></label><ul></ul></li><li><input type=checkbox id=section-86e89c76906928d0f1ba213f94c31800 class=toggle>
<label for=section-86e89c76906928d0f1ba213f94c31800 class="flex justify-between"><a role=button>Tesseract</a></label><ul></ul></li></ul></li><li><input type=checkbox id=section-4404243c90aaf852c09add5b5557b400 class=toggle>
<label for=section-4404243c90aaf852c09add5b5557b400 class="flex justify-between"><a role=button>Programming</a></label><ul><li><input type=checkbox id=section-b7178fd2927c3e62d8a4e45fb55e60a7 class=toggle>
<label for=section-b7178fd2927c3e62d8a4e45fb55e60a7 class="flex justify-between"><a role=button>Awk</a></label><ul><li><a href=/docs/programming/awk/basics/>Basics</a></li></ul></li><li><input type=checkbox id=section-6cfd14a35e3949908c635cdeeacc0084 class=toggle>
<label for=section-6cfd14a35e3949908c635cdeeacc0084 class="flex justify-between"><a role=button>Bash</a></label><ul><li><a href=/docs/programming/bash/basics/>Basics</a></li></ul></li><li><input type=checkbox id=section-e5ff87ffd212150f3d29c33ed735f13e class=toggle>
<label for=section-e5ff87ffd212150f3d29c33ed735f13e class="flex justify-between"><a role=button>Batch</a></label><ul><li><a href=/docs/programming/batch/basics/>Basics</a></li></ul></li><li><input type=checkbox id=section-e5159efec64bdeff5e89f0d6097b0490 class=toggle>
<label for=section-e5159efec64bdeff5e89f0d6097b0490 class="flex justify-between"><a role=button>C#</a></label><ul><li><a href=/docs/programming/csharp/basics/>Basics</a></li></ul></li><li><input type=checkbox id=section-b0231b0e110de6fc607111305d8ab683 class=toggle>
<label for=section-b0231b0e110de6fc607111305d8ab683 class="flex justify-between"><a role=button>Go</a></label><ul><li><a href=/docs/programming/go/basics/>Basics</a></li><li><a href=/docs/programming/go/cgi/>Cgi</a></li><li><a href=/docs/programming/go/installation/>Installation</a></li></ul></li><li><input type=checkbox id=section-7d2d89e16c410986f302f6018a766478 class=toggle>
<label for=section-7d2d89e16c410986f302f6018a766478 class="flex justify-between"><a role=button>Powershell</a></label><ul><li><a href=/docs/programming/powershell/azdo/>Azdo</a></li><li><a href=/docs/programming/powershell/basics/>Basics</a></li><li><a href=/docs/programming/powershell/snippets/>Snippets</a></li></ul></li><li><input type=checkbox id=section-9574b6d1167d7327522b0f42bc5a4c8e class=toggle>
<label for=section-9574b6d1167d7327522b0f42bc5a4c8e class="flex justify-between"><a role=button>Python</a></label><ul><li><a href=/docs/programming/python/basics/>Basics</a></li><li><a href=/docs/programming/python/environment/>Environment</a></li><li><a href=/docs/programming/python/installation/>Installation</a></li></ul></li><li><input type=checkbox id=section-b02cfcac3355f9db66ee8423a9173bb3 class=toggle>
<label for=section-b02cfcac3355f9db66ee8423a9173bb3 class="flex justify-between"><a role=button>SQLite</a></label><ul><li><a href=/docs/programming/sqlite/data/>Data</a></li></ul></li><li><input type=checkbox id=section-90b0b18d2b29f7afc148bc24636416c6 class=toggle>
<label for=section-90b0b18d2b29f7afc148bc24636416c6 class="flex justify-between"><a role=button>Typescript</a></label><ul><li><a href=/docs/programming/typescript/nodejs/>Nodejs</a></li></ul></li></ul></li></ul><ul><li><a href=/posts/>Blog</a></li><li><a href=https://github.com/dpurge/dpurge.github.io target=_blank rel=noopener>Github</a></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu>
</label><strong>Iam</strong>
<label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#iam>IAM</a><ul><li><a href=#policy-architecture>Policy architecture</a></li><li><a href=#policy-limitations>Policy limitations</a></li><li><a href=#policy-conditions>Policy conditions</a></li><li><a href=#audit-config-logs>Audit config logs</a></li><li><a href=#edit-policy>Edit policy</a></li><li><a href=#service-accounts>Service accounts</a></li><li><a href=#cloud-identity>Cloud identity</a></li></ul></li></ul></nav></aside></header><article class=markdown><h1 id=iam>IAM
<a class=anchor href=#iam>#</a></h1><p>IAM = Identity Access Management</p><p>Manages: <em>Identity</em> (who?) has <em>role</em> (what access) for which <em>resource</em> (or organization, project, folder).</p><p>Use the principle of least access.</p><p>Permissions not granted directly to the user.
Permissions are grouped into roles which are granted to the authenticated members.</p><p>IAM policy defines and enforces what roles are granted to which members.
This policy is attached to a resource.</p><h2 id=policy-architecture>Policy architecture
<a class=anchor href=#policy-architecture>#</a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>Policy</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>Metadata</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>etags</span>: <span style=color:#ae81ff>concurrency control</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>version</span>: <span style=color:#ae81ff>specifies schema version</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>Audit-Config</span>: <span style=color:#ae81ff>configures audit logging</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>Binding</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>Condition</span>: <span style=color:#ae81ff>constrains binding</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>Member</span>: []
</span></span><span style=display:flex><span>    <span style=color:#f92672>Role</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>Permissions</span>: []
</span></span></code></pre></div><p>Member is an identity that can access a resource.
Identity is an e-mail account associated with a user, service account or a Google group, a domain name associated with a GSuite or cloud identity domains.</p><dl><dt>Google Account</dt><dd>any email address that is associated with a Google Account, either gmail.com or other domains</dd><dt>Service Account</dt><dd>an account for an application instead of an individual end user</dd><dt>Google Group</dt><dd>a named collection of Google Accounts and service accounts</dd><dt>G Suite Domain</dt><dd>Google Accounts created in an organization&rsquo;s G Suite account</dd><dt>Cloud Identity Domain</dt><dd>Google Accounts in an organization that are not tied to any G Suite applications or features</dd><dt>AllAUthenticatedUsers</dt><dd>a special identifier that represents all service accounts and all users on the internet who have authenticated with a Google Account</dd><dt>AllUsers</dt><dd>a special identifier that represents anyone, including authenticated and unauthenticated users</dd></dl><p>Permissions determine what operations are allowed on a resource.
They correspond one-to-one with REST API methods.
Permissions are not granted to users directly.
You grant roles which contain one or more permissions.
Permissions are represented as <em>{service}.{resource}.{verb}</em>, eg. <code>compute.instances.list</code></p><p>Roles are collections of permissions.
You cannot grant a permission to the user directly.
You grant a role to a user and all the permissions that the role contains.</p><p>There are three types of roles:</p><dl><dt>Primitive roles</dt><dd><code>Owner</code>, <code>Editor</code>, <code>Viewer</code>; historically available prior to IAM; avoid using these roles; can only be grated from a Google console</dd><dt>Predefined roles</dt><dd>finer-grained access control than the primitive roles; created and maintained by Google</dd><dt>Custom roles</dt><dd>tailor permissions to the needs of your organization; not maintained by Google; cannot be created at folder level; by default only project owner can create new roles</dd></dl><p>Custom role <em>launch stages</em>:</p><ul><li>alpha = in testing</li><li>beta = tested and awaiting approval</li><li>ga = generally available</li></ul><p>Condition is a logic expression used to define and enforce attribute-based access control for Google Cloud resources.
Conditions allow you to choose granting resource access to identities only if configured conditions are met.
When a contition exists, the access request is only granted if the condition expression evaluates to <code>true</code>.</p><p>Metadata etags prevent a race condition when updating the policy.</p><p>Metadata version is used to avoid breaking existing integrations that rely on consistency in the policy structure when new policy schema versions are introduced.</p><p>Audit config configures audit logging; determines which permission types are logged and what identities are exempted from logging.</p><p>Resource inherit the policies of all their parent resources.
The policy is a union of a resource direct policy and the policies of all its parents in the resource hierarchy (organization, folders, project, resource).</p><p>Example policy statement (can be expressed in JSON or YAML):</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;bindings&#34;</span>: [
</span></span><span style=display:flex><span>        {
</span></span><span style=display:flex><span>            <span style=color:#f92672>&#34;role&#34;</span>: <span style=color:#e6db74>&#34;roles/storage.admin&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#f92672>&#34;members&#34;</span>: [
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#34;user:example@gmail.com&#34;</span>
</span></span><span style=display:flex><span>            ]
</span></span><span style=display:flex><span>        },
</span></span><span style=display:flex><span>        {
</span></span><span style=display:flex><span>            <span style=color:#f92672>&#34;role&#34;</span>: <span style=color:#e6db74>&#34;roles/storage.objectViewer&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#f92672>&#34;members&#34;</span>: [
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#34;user:other@gmail.com&#34;</span>
</span></span><span style=display:flex><span>            ],
</span></span><span style=display:flex><span>            <span style=color:#f92672>&#34;condition&#34;</span>: {
</span></span><span style=display:flex><span>                <span style=color:#f92672>&#34;title&#34;</span>: <span style=color:#e6db74>&#34;Expires_January_1_2021&#34;</span>,
</span></span><span style=display:flex><span>                <span style=color:#f92672>&#34;description&#34;</span>: <span style=color:#e6db74>&#34;Do not grant access after Jan 2021&#34;</span>,
</span></span><span style=display:flex><span>                <span style=color:#f92672>&#34;expression&#34;</span>: <span style=color:#e6db74>&#34;request.time &lt; timestamp(&#39;2021-01-01T00:00:00.000Z&#39;)&#34;</span>
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    ],
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;etag&#34;</span>: <span style=color:#e6db74>&#34;BeEEja0YfWJ=&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;version&#34;</span>: <span style=color:#ae81ff>3</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Querying for policies:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>gcloud projects get-iam-policy <span style=color:#f92672>{</span>project-id<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>gcloud resource-manager folders get-iam-policy <span style=color:#f92672>{</span>folder-id<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>gcloud organizations get-iam-policy <span style=color:#f92672>{</span>organization-id<span style=color:#f92672>}</span>
</span></span></code></pre></div><p>Policy versions:</p><dl><dt>version 1</dt><dd>default; supports binding one role to one or more members; does not support conditional role bindings</dd><dt>version 2</dt><dd>for Google&rsquo;s internal use</dd><dt>version 3</dt><dd>introduces condition statement</dd></dl><h2 id=policy-limitations>Policy limitations
<a class=anchor href=#policy-limitations>#</a></h2><ul><li>each resource can only have one policy (including organizations, projects, folders)</li><li>max 1500 members or 250 Google groups per policy</li><li>up to 7 minutes for a policy change to fully propagate across GCP</li><li>max 100 conditional role bindings per policy</li></ul><h2 id=policy-conditions>Policy conditions
<a class=anchor href=#policy-conditions>#</a></h2><p>Condition attributes are either based on resource or based on details of the request, eg. timestamp or originating/destination IP address</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>bindings</span>:
</span></span><span style=display:flex><span>- <span style=color:#f92672>members</span>:
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>user:me@gmail.com</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>role</span>: <span style=color:#ae81ff>roles/owner</span>
</span></span><span style=display:flex><span>- <span style=color:#f92672>members</span>:
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>user:example@gmail.com</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>role</span>: <span style=color:#ae81ff>roles/storage.objectViewer</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>condition</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>title</span>: <span style=color:#ae81ff>Business_hours_access</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>description</span>: <span style=color:#ae81ff>Business hours access Monday-Friday</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>expression</span>: <span style=color:#ae81ff>request.time.getHours(&#34;America/Toronto&#34;) &gt;= 9 &amp;&amp;</span>
</span></span><span style=display:flex><span>                <span style=color:#ae81ff>request.time.getHours(&#34;America/Toronto&#34;) &lt;= 17 &amp;&amp;</span>
</span></span><span style=display:flex><span>                <span style=color:#ae81ff>// 0 = Sunday, 6 = Saturday</span>
</span></span><span style=display:flex><span>                <span style=color:#ae81ff>request.time.getDayOfWeek(&#34;America/Toronto&#34;) &gt;= 1 &amp;&amp;</span>
</span></span><span style=display:flex><span>                <span style=color:#ae81ff>request.time.getDayOfWeek(&#34;America/Toronto&#34;) &lt;= 5</span>
</span></span><span style=display:flex><span><span style=color:#f92672>etag</span>: <span style=color:#ae81ff>xxx</span>
</span></span><span style=display:flex><span><span style=color:#f92672>version</span>: <span style=color:#ae81ff>3</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>bindings</span>:
</span></span><span style=display:flex><span>- <span style=color:#f92672>members</span>:
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>user:me@gmail.com</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>role</span>: <span style=color:#ae81ff>roles/owner</span>
</span></span><span style=display:flex><span>- <span style=color:#f92672>members</span>:
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>group:developer@mydomain.com</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>role</span>: <span style=color:#ae81ff>roles/compute.instanceAdmin</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>condition</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>title</span>: <span style=color:#ae81ff>Dev_only_access</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>description</span>: <span style=color:#ae81ff>Only access to development* VMs</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>expression</span>: <span style=color:#ae81ff>(resource.type == &#39;compute.googleapis.com/Disk&#39; &amp;&amp;</span>
</span></span><span style=display:flex><span>                <span style=color:#ae81ff>resource.name.startsWith(&#39;projects/project-my-example/regions/us-central1/disks/development&#39;)) ||</span>
</span></span><span style=display:flex><span>                <span style=color:#ae81ff>(resource.type == &#39;compute.googleapis.com/Instance&#39; &amp;&amp;</span>
</span></span><span style=display:flex><span>                <span style=color:#ae81ff>resource.name.startsWith(&#39;projects/project-my-example/zones/us-central1-a/instances/development&#39;)) ||</span>
</span></span><span style=display:flex><span>                <span style=color:#ae81ff>(resource.type != &#39;compute.googleapis.com/Instance&#39; &amp;&amp;</span>
</span></span><span style=display:flex><span>                <span style=color:#ae81ff>resource.type != &#39;compute.googleapis.com/Disk&#39;)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>etag</span>: <span style=color:#ae81ff>xxx</span>
</span></span><span style=display:flex><span><span style=color:#f92672>version</span>: <span style=color:#ae81ff>3</span>
</span></span></code></pre></div><p>Condition limitations:</p><ul><li>limited to specific services</li><li>primitive roles are not supported</li><li>members cannot be <code>allUsers</code> or <code>allAuthenticatedUsers</code></li><li>max 100 conditional role bindings per policy</li><li>max 20 role bindings for the same role and the same member</li></ul><h2 id=audit-config-logs>Audit config logs
<a class=anchor href=#audit-config-logs>#</a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>auditConfigs</span>:
</span></span><span style=display:flex><span>- <span style=color:#f92672>auditLogConfigs</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>logType</span>: <span style=color:#ae81ff>DATA_READ</span>
</span></span><span style=display:flex><span>  - <span style=color:#f92672>logType</span>: <span style=color:#ae81ff>ADMIN_READ</span>
</span></span><span style=display:flex><span>  - <span style=color:#f92672>logType</span>: <span style=color:#ae81ff>DATA_WRITE</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>service</span>: <span style=color:#ae81ff>allServices</span>
</span></span><span style=display:flex><span>- <span style=color:#f92672>auditLogConfigs</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>exmptedMembers</span>:
</span></span><span style=display:flex><span>    - <span style=color:#ae81ff>me@gmail.com</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>logType</span>: <span style=color:#ae81ff>ADMIN_READ</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>service</span>: <span style=color:#ae81ff>storage.googleapis.com</span>
</span></span></code></pre></div><h2 id=edit-policy>Edit policy
<a class=anchor href=#edit-policy>#</a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>gcloud projects get-iam-policy <span style=color:#f92672>{</span>project-id<span style=color:#f92672>}</span> &gt; new-policy.yaml
</span></span><span style=display:flex><span>gcloud projects set-iam-policy <span style=color:#f92672>{</span>project-id<span style=color:#f92672>}</span> new-policy.yaml
</span></span></code></pre></div><p>Make sure that etag is correct, or you will not be able to set the new policy.</p><p>Granting access from the command line:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>gcloud projects add-iam-policy-binding <span style=color:#f92672>{</span>project-id<span style=color:#f92672>}</span> --member user:somebody@gmail.com --role roles/storage.admin
</span></span></code></pre></div><h2 id=service-accounts>Service accounts
<a class=anchor href=#service-accounts>#</a></h2><p>A service account is both an identity and a resource.</p><p>Service account is a special kind of account used by an application or a virtual machine instance and not a person.
It represents a non-human user.
A service account is identified by an email address which is unique.</p><p>There are three service account types:</p><dl><dt>User-managed</dt><dd>user created; you choose the name; default quota 100 user accounts per project</dd><dt>Default</dt><dd>some services automatically create user-managed service account with <em>Editor</em> role for the project; Google recommends revoking Editor role manually</dd><dt>Google-managed</dt><dd>created and managed by Google; used by Google services; some visible, some hidden; name ends with &ldquo;Service Agent&rdquo; or &ldquo;Service Account&rdquo;; do not change or revoke roles for these accounts</dd></dl><p>Email format for user mananaged service accounts: <code>{service-name}@{project-id}.iam.gserviceaccount.com</code></p><p>Email formats for the default service accounts:</p><ul><li><code>{project-id}@appspot.gserviceaccount.com</code></li><li><code>{project-number}-compute@developer.gserviceaccount.com</code></li></ul><p>Service accounts authenticate using keys.
Each service has two sets of private and public RSA keypairs.</p><p>There are Google managed and user managed keys.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>gcloud iam service-accounts list
</span></span><span style=display:flex><span>gcloud iam service-accounts create sa-example --display-name<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;sa-example&#39;</span>
</span></span><span style=display:flex><span>gcloud projects add-iam-policy-binding <span style=color:#f92672>{</span>project-name<span style=color:#f92672>}</span> --member <span style=color:#e6db74>&#39;serviceAccount:{account-name}@{project-name}.iam.gserviceaccount.com&#39;</span> --role <span style=color:#e6db74>&#39;roles/storage.objectViewer&#39;</span>
</span></span><span style=display:flex><span>gcloud compute instances stop instance-1 --zone us-central1-a
</span></span><span style=display:flex><span>gcloud compute instances set-service-account instance-1 --zone us-central1-a --service-account sa-example@<span style=color:#f92672>{</span>project-name<span style=color:#f92672>}</span>.iam.gserviceaccount.com
</span></span><span style=display:flex><span>gcloud compute instances start instance-1 --zone us-central1
</span></span></code></pre></div><h2 id=cloud-identity>Cloud identity
<a class=anchor href=#cloud-identity>#</a></h2><p>Identity as a service (SSO, device management, security, reporting, directory management).</p></article><footer class=book-footer><div class="flex flex-wrap justify-between"><div><a class="flex align-center" href=https://github.com/dpurge/dpurge.github.io/commit/40767cf6ec454af84df1b0960db369fff1a43f86 title='Last modified by David P | November 5, 2024' target=_blank rel=noopener><img src=/svg/calendar.svg class=book-icon alt=Calendar>
<span>November 5, 2024</span></a></div><div><a class="flex align-center" href=https://github.com/dpurge/dpurge.github.io/edit/main/content/docs/devops/gcp/iam.md target=_blank rel=noopener><img src=/svg/edit.svg class=book-icon alt=Edit>
<span>Edit this page</span></a></div></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#iam>IAM</a><ul><li><a href=#policy-architecture>Policy architecture</a></li><li><a href=#policy-limitations>Policy limitations</a></li><li><a href=#policy-conditions>Policy conditions</a></li><li><a href=#audit-config-logs>Audit config logs</a></li><li><a href=#edit-policy>Edit policy</a></li><li><a href=#service-accounts>Service accounts</a></li><li><a href=#cloud-identity>Cloud identity</a></li></ul></li></ul></nav></div></aside></main></body></html>